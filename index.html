<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tetris Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #222;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #333;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        canvas {
            background-color: #000;
            border: 2px solid #555;
            display: block;
            margin: 0 auto;
        }
        
        button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        .info-panel {
            display: flex;
            justify-content: space-between;
            width: 300px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Tetris</h1>
        <div class="info-panel">
            <div>Score: <span id="score">0</span></div>
            <div>Level: <span id="level">1</span></div>
        </div>
        <canvas id="tetris" width="240" height="400"></canvas>
        <div>
            <button id="start-button">Start Game</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('tetris');
            const ctx = canvas.getContext('2d');
            const scoreElement = document.getElementById('score');
            const levelElement = document.getElementById('level');
            const startButton = document.getElementById('start-button');
            
            // Game constants
            const ROWS = 20;
            const COLS = 12;
            const BLOCK_SIZE = 20;
            const EMPTY = 'black';
            
            // Game variables
            let board = [];
            let currentPiece;
            let score = 0;
            let level = 1;
            let gameOver = false;
            let intervalId;
            
            // Tetris pieces and their colors
            const PIECES = [
                [I, "cyan"],
                [J, "blue"],
                [L, "orange"],
                [O, "yellow"],
                [S, "green"],
                [T, "purple"],
                [Z, "red"]
            ];
            
            // Piece shapes
            function I() {
                return [
                    [0, 0, 0, 0],
                    [1, 1, 1, 1],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0]
                ];
            }
            
            function J() {
                return [
                    [1, 0, 0],
                    [1, 1, 1],
                    [0, 0, 0]
                ];
            }
            
            function L() {
                return [
                    [0, 0, 1],
                    [1, 1, 1],
                    [0, 0, 0]
                ];
            }
            
            function O() {
                return [
                    [1, 1],
                    [1, 1]
                ];
            }
            
            function S() {
                return [
                    [0, 1, 1],
                    [1, 1, 0],
                    [0, 0, 0]
                ];
            }
            
            function T() {
                return [
                    [0, 1, 0],
                    [1, 1, 1],
                    [0, 0, 0]
                ];
            }
            
            function Z() {
                return [
                    [1, 1, 0],
                    [0, 1, 1],
                    [0, 0, 0]
                ];
            }
            
            // Initialize board
            function createBoard() {
                for (let r = 0; r < ROWS; r++) {
                    board[r] = [];
                    for (let c = 0; c < COLS; c++) {
                        board[r][c] = EMPTY;
                    }
                }
            }
            
            // Draw a square
            function drawSquare(x, y, color) {
                ctx.fillStyle = color;
                ctx.fillRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
                ctx.strokeStyle = "#555";
                ctx.strokeRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
            }
            
            // Draw the board
            function drawBoard() {
                for (let r = 0; r < ROWS; r++) {
                    for (let c = 0; c < COLS; c++) {
                        drawSquare(c, r, board[r][c]);
                    }
                }
            }
            
            // Generate random piece
            function randomPiece() {
                const randomIndex = Math.floor(Math.random() * PIECES.length);
                const [pieceFunction, color] = PIECES[randomIndex];
                const shape = pieceFunction();
                
                return {
                    shape,
                    color,
                    x: Math.floor(COLS / 2) - Math.floor(shape[0].length / 2),
                    y: 0
                };
            }
            
            // Draw the current piece
            function drawPiece() {
                for (let r = 0; r < currentPiece.shape.length; r++) {
                    for (let c = 0; c < currentPiece.shape[r].length; c++) {
                        if (currentPiece.shape[r][c]) {
                            drawSquare(currentPiece.x + c, currentPiece.y + r, currentPiece.color);
                        }
                    }
                }
            }
            
            // Move piece down
            function moveDown() {
                if (!collision(0, 1)) {
                    currentPiece.y++;
                } else {
                    lockPiece();
                    removeRows();
                    currentPiece = randomPiece();
                    
                    if (collision(0, 0)) {
                        gameOver = true;
                        clearInterval(intervalId);
                        alert("Game Over! Your score: " + score);
                    }
                }
            }
            
            // Move piece left
            function moveLeft() {
                if (!collision(-1, 0)) {
                    currentPiece.x--;
                }
            }
            
            // Move piece right
            function moveRight() {
                if (!collision(1, 0)) {
                    currentPiece.x++;
                }
            }
            
            // Rotate piece
            function rotate() {
                const rotated = [];
                const N = currentPiece.shape.length;
                
                for (let i = 0; i < N; i++) {
                    rotated[i] = [];
                    for (let j = 0; j < N; j++) {
                        rotated[i][j] = currentPiece.shape[N - j - 1][i];
                    }
                }
                
                const piece = JSON.parse(JSON.stringify(currentPiece));
                piece.shape = rotated;
                
                if (!collision(0, 0, piece)) {
                    currentPiece = piece;
                }
            }
            
            // Check for collision
            function collision(x, y, piece = currentPiece) {
                for (let r = 0; r < piece.shape.length; r++) {
                    for (let c = 0; c < piece.shape[r].length; c++) {
                        if (!piece.shape[r][c]) continue;
                        
                        const newX = piece.x + c + x;
                        const newY = piece.y + r + y;
                        
                        if (newX < 0 || newX >= COLS || newY >= ROWS) {
                            return true;
                        }
                        
                        if (newY < 0) continue;
                        
                        if (board[newY][newX] !== EMPTY) {
                            return true;
                        }
                    }
                }
                return false;
            }
            
            // Lock piece in place
            function lockPiece() {
                for (let r = 0; r < currentPiece.shape.length; r++) {
                    for (let c = 0; c < currentPiece.shape[r].length; c++) {
                        if (!currentPiece.shape[r][c]) continue;
                        
                        if (currentPiece.y + r < 0) {
                            gameOver = true;
                            break;
                        }
                        
                        board[currentPiece.y + r][currentPiece.x + c] = currentPiece.color;
                    }
                }
            }
            
            // Remove completed rows
            function removeRows() {
                let rowsCleared = 0;
                
                for (let r = 0; r < ROWS; r++) {
                    let isRowFull = true;
                    
                    for (let c = 0; c < COLS; c++) {
                        if (board[r][c] === EMPTY) {
                            isRowFull = false;
                            break;
                        }
                    }
                    
                    if (isRowFull) {
                        rowsCleared++;
                        
                        // Move all rows above down
                        for (let y = r; y > 0; y--) {
                            for (let c = 0; c < COLS; c++) {
                                board[y][c] = board[y-1][c];
                            }
                        }
                        
                        // Add empty row at top
                        for (let c = 0; c < COLS; c++) {
                            board[0][c] = EMPTY;
                        }
                    }
                }
                
                // Update score
                if (rowsCleared > 0) {
                    score += rowsCleared * 100 * level;
                    scoreElement.textContent = score;
                    
                    // Update level
                    level = Math.floor(score / 1000) + 1;
                    levelElement.textContent = level;
                    
                    // Speed up game
                    clearInterval(intervalId);
                    intervalId = setInterval(gameLoop, 1000 / level);
                }
            }
            
            // Game loop
            function gameLoop() {
                if (gameOver) return;
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawBoard();
                drawPiece();
                moveDown();
            }
            
            // Control handlers
            document.addEventListener('keydown', function(e) {
                if (gameOver) return;
                
                switch(e.keyCode) {
                    case 37: // Left arrow
                        moveLeft();
                        break;
                    case 38: // Up arrow
                        rotate();
                        break;
                    case 39: // Right arrow
                        moveRight();
                        break;
                    case 40: // Down arrow
                        moveDown();
                        break;
                    case 32: // Space
                        while (!collision(0, 1)) {
                            moveDown();
                        }
                        break;
                }
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawBoard();
                drawPiece();
            });
            
            // Start game
            startButton.addEventListener('click', function() {
                // Reset game state
                createBoard();
                score = 0;
                level = 1;
                gameOver = false;
                scoreElement.textContent = score;
                levelElement.textContent = level;
                
                // Create first piece
                currentPiece = randomPiece();
                
                // Start game loop
                if (intervalId) {
                    clearInterval(intervalId);
                }
                intervalId = setInterval(gameLoop, 1000);
                
                // Hide start button
                startButton.style.display = 'none';
            });
            
            // Initialize game
            createBoard();
            drawBoard();
        });
    </script>
</body>
</html>